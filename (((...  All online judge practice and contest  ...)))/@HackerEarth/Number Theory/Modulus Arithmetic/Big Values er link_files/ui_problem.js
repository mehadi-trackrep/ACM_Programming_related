/**
 * Name: ui_problem.js
 * Description: Script file to handle UI/UX Problems, their
 * code editors and code video recording
 */function IframeCaptureMessage(a,b){$("#editor-console-tab").append("<li class='"+b+"'>"+a+"</li>")}function initializeEditor(){function e(){var a={},c={HTML:{lang:"ace/mode/html",editor_id:"editor-html-tab",display_name:"HTML",enabled:!1},CSS:{lang:"ace/mode/css",editor_id:"editor-css-tab",display_name:"CSS",enabled:!1},JAVASCRIPT_UI:{lang:"ace/mode/javascript",editor_id:"editor-js-tab",display_name:"JAVASCRIPT",enabled:!1}};if(allowed_langs.length<=2){var e=$("#editor-iframe-output").parent().clone().addClass("full-height float-right");$("#editor-iframe-output").parent().remove(),$(".editor").prepend(e),allowed_langs.length==1&&($(".editor-tab-parent").addClass("full-height"),$(".editor-tab-parent").addClass("full-width"))}allowed_langs.indexOf("HTML")===-1?($("#editor-iframe-output").parent().hide(),$(".editor-menu .editor-menu-option").hide(),$(".editor-tab-parent").addClass("full-height")):($("#editor-iframe-output").parent().show(),$(".editor-tab-parent").removeClass("full-width"));for(var i=0;i<allowed_langs.length;i++)c[allowed_langs[i]].enabled=!0,a[allowed_langs[i]]=ace.edit(c[allowed_langs[i]].editor_id),$("#"+c[allowed_langs[i]].editor_id).parent(".editor-tab-parent").show();$.each(c,function(e,g){if(c[e].enabled===!0){a[e].getSession().setMode(c[e].lang),b=a[e],editor_global=b,b.onPaste=function(a){overridePasteEvent(this,a)},set_editor_preferences(b.getSession(),e),autocomplete_options={enableBasicAutocompletion:!0,enableSnippets:!0},LAB_FEATURE_MAP.LC&&(autocomplete_options.enableLiveAutocompletion=!0),editor_global.setOptions(autocomplete_options),b.setReadOnly(!0),b.code_player=null,$.ajax({key:e,ui_editors:a,editor:b,url:$("p[lang="+e+"]").attr("ajax_url"),success:function(b){b=b.data[0],this.editor.setValue(b.source),this.editor.setReadOnly(!1),this.editor.clearSelection();if(this.key==="JAVASCRIPT_UI"||allowed_langs.length<=2&&this.key==="CSS"||allowed_langs.length<=1&&this.key==="HTML")h(a),d();this.editor.lang=e,this.editor.source=b.source,this.editor.source_loaded=!0,this.editor.last_edited=b.last_edited,f(this.editor)}});var i={},j=get_problem_slug(),k=get_problem_type();i[e]=$("p[lang="+e+"]").attr("id");var l={langs:JSON.stringify([e]),problem_slug:j,p_type_verbose:k};setup_video(l,function(b,d){if(b.status=="OK"&&d){var g=b.lang_code_video_id_map,h=g[e].id,i=g[e].uuid;if(h){a[e].code_player=new CodePlayer(h);var j="code-video-links",k={id:"code-video-link-"+e,"class":"button btn-blue-outline float-left",href:"http://"+window.location.hostname+"/code/play/"+i},l=c[e].display_name,m=" Play Code ("+l+")";a[e].code_player.render_video_link(j,k,m)}f(a[e])}},{lang_tab_id_map:i})}}),b=null,editor_global=null,$("#editor-html-tab, #editor-css-tab, #editor-js-tab").css("font-size",preference.fontsize),g(a)}function f(a){var b=function(){return function(b){var c=a.session,d=a.code_player,e=a.source,f=a.lang,g=(new Date).getTime();a.source=c.getValue(),a.last_edited=g,d.enqueue_changeset(b,e),d.start_recording()}}(a);a.source_loaded&&a.code_player&&a.session.on("change",b)}function g(b){$(".run-render").off("click"),$(".run-render").on("click",function(){$(this).hasClass("disabled")||d()}),$("input[name=dynamicChange]").off("change"),$("input[name=dynamicChange]").on("change",function(){a=!a,$(".run-render").toggleClass("disabled"),a&&d()}),$(".editor-tab-title span").off("click"),$(".editor-tab-title span").on("click",function(){$(this).hasClass("selected")||($(".editor-tab-title span").removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("console")?($("#editor-iframe-output").hide(),$("#editor-console-tab").show(),$(".clear-console").show()):($("#editor-console-tab").hide(),$("#editor-iframe-output").show(),$(".clear-console").hide()))});var c=function(){$(".expand-collapse-editor").find(".fa").toggleClass("fa-expand").toggleClass("fa-compress"),$(".new-submission-container.ui-problem .editor-main").toggleClass("expanded"),$(".submit-clone-head").toggle(),$.each(b,function(a,b){b.resize()}),$(".new-submission-container.ui-problem").hasClass("ui-challenge")&&$(".new-submission-container.ui-problem .editor-main.primary-main").toggle()};$(".expand-collapse-editor").off("click"),$(".expand-collapse-editor").on("click",function(){c()}),$(document).on("keyup",function(a){var b=$(".new-submission-container.ui-problem .editor-main").hasClass("expanded");a.keyCode==27&&b&&c()}),$(".clear-console").off("click"),$(".clear-console").on("click",function(){$("#editor-console-tab").html("")}),$(".html-help").off("click"),$(".html-help").on("click",function(){$("#html-help-modal .modal-content li button").removeClass("disabled")}),$("#html-help-modal .modal-content li button").off("click"),$("#html-help-modal .modal-content li button").on("click",function(){if(!$(this).hasClass("disabled")){var a=b.HTML.getValue();a=a.replace("</body>",'	<script src="'+$(this).data("src")+'">'+"</script>\n	</body>"),b.HTML.setValue(a),b.HTML.clearSelection(),$(this).addClass("disabled")}}),$(".submit-clone").die("click"),$(".submit-clone").live("click",function(){$(".submit-clone-head").html('<i class="fa fa-spinner fa-pulse darker"></i>'),$("#preview-ui-button").trigger("click")}),$("#preview-ui-button").off("click"),$("#preview-ui-button").on("click",function(){$(".ajax-loader").show(),$(".submission-response").html(""),$(".submission-container").hide(),$(".submission-container-pre").show();var a=get_problem_slug(),c=$(this).attr("ajax"),d={problem_slug:a},e="",f="",g="",h="";allowed_langs.indexOf("HTML")!==-1&&(e=b.HTML.getValue(),d.html=e),allowed_langs.indexOf("CSS")!==-1&&(f=b.CSS.getValue(),d.css=f),allowed_langs.indexOf("JAVASCRIPT_UI")!==-1&&(g=b.JAVASCRIPT_UI.getValue(),d.javascript=g);if(allowed_langs.indexOf("HTML")!==-1){h=e;if(allowed_langs.indexOf("CSS")!==-1){var i="\n<style>\n"+f+"\n</style>\n	";h=h.replace("</head>",i+"</head>")}if(allowed_langs.indexOf("JAVASCRIPT_UI")!==-1){var j="\n<script>\n"+g+"\n</script>\n	";h=h.replace("</body>",j+"</body>")}d.html_combined=h}$("#preview-ui-button").hide(),$.ajax({type:"POST",url:c,data:d,success:function(a){a!==""&&a.indexOf("http")>=0?($(".submission-response").html('<span class="preview-link">Preview Link: </span><a href="#" id="preview" url="'+a+'">'+a+"</a>"),addAlert("Code submitted successfully.")):($(".submission-response").html(a),addAlert(a)),$("#submission-result").parent().show(),$(".submission-container-pre").hide(),$(".ajax-loader").toggle(),$("#preview-ui-button").show(),$(".submit-clone-head").html('<button type="button" class="button btn-blue submit-clone">Submit</button>')},error:function(a){addAlert("Please try again. There was some error!"),$(".error-output").html("Please try again. There was some error!"),$(".error-output").show(),$(".output").hide(),$(".ajax-loader").toggle(),$("#preview-ui-button").show(),$(".submit-clone-head").html('<button type="button" class="button btn-blue submit-clone">Submit</button>')}})}),$(".tag-missing-error .fa").on("click",function(){$(".tag-missing-error").fadeOut()})}function h(b){$.each(b,function(b,c){c.getSession().selection.on("changeCursor",function(b){a&&d()})});var c=function(){var a="",c="",d="",f="";try{a=b.HTML.getValue();if(!(a.toLowerCase().indexOf("</html>")>-1&&a.toLowerCase().indexOf("</body>")>-1))return e(),"";$(".tag-missing-error").fadeOut(),c='function sendMessage(o,e){window.parent.IframeCaptureMessage(o,e)}!function(){window.console&&(console.log=function(o){sendMessage(o,"console-log")},console.info=function(o){sendMessage(o,"console-log")},console.debug=function(o){sendMessage(o,"console-log console-blue")},console.warn=function(o){sendMessage(o,"console-log console-orange")},console.error=function(o){sendMessage(o,"console-log console-red")}),window.onerror=function(o,e,n){sendMessage(o+" on line number: "+n,"console-log console-red")}}();'}catch(g){}try{f="<style>"+b.CSS.getValue()+"</style>",a.toLowerCase().indexOf("</head>")>-1?a=a.replace("</head>",f+"</head>"):a.toLowerCase().indexOf("<html>")>-1?a=a.replace("<html>","<html>"+f):a=a.replace("</body>",f+"</body>")}catch(g){}try{d="<script>"+c+b.JAVASCRIPT_UI.getValue()+"</script>",a=a.replace("</body>",d+"</body>")}catch(g){}return a};$("#editor-iframe-output").on("load",function(){var a=c(),b=document.getElementById("editor-iframe-output").contentWindow.document;b.open(),b.write(a),b.close()});var e=function(){$(".tag-missing-error").fadeIn()};d=function(){try{document.getElementById("editor-iframe-output").contentWindow.location.reload(!0)}catch(a){}}}var a=!1,b=null,c,d;e()};