/*!CK:2870703485!*//*1459738736,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["aq0ny"]); }

__d("XQuickPromotionFeedPivotController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/qp\/feed_pivot\/",{action_trigger:{type:"String",required:true},ft_id:{type:"String"}});},null);
__d('PubcontentFeedChainingControllerX',['csx','cx','AggregatedLinkComposerConfig','Arbiter','AsyncRequest','AttachmentRelatedShareConstants','ContextualThing','CSS','DOM','DOMQuery','FeedAdsChainingConfig','NavigationMessage','PageLikeConstants','PubcontentFeedChainingConfig','PubcontentRelatedShareChainingConfig','PubcontentTopicChainingConfig','RelatedEventsPivotChainingConfig','Run','SearchRelatedPostsPivotChainingConfig','StoryInlinePivotChainingConfig','StoryTopicMap','SubscriptionsHandler','UFIFeedbackTargets','UFIUIEvents','XEventRelatedEventsPivotController','XPubcontentCommerceProductChainingController','XFeedAdsChainingController','XPubcontentFeedChainingController','XPubcontentInlineStoryPivotChainingController','XPubcontentRelatedShareChainingController','XPubcontentRelatedVideoChainingController','XPubcontentTopicChainingController','XQuickPromotionFeedPivotController','XRelatedGamesChainingController','XSearchRelatedPostsPivotController','getOrCreateDOMID'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j='ei',k='ad_fan_page_action',l='ad_like_page_post_action',m='page_story_like_action',n='related_share_article_click',o='related_product_click',p='related_share_video_click',q='page_share_like_action',r='topic_story_like_action',s='story_click_for_pivot_action',t='story_like_pivot_action',u='event_join',v='composer_publish_action',w=null,x=false;y.init=function(z){var aa=z.isLazy;'use strict';if(!w)w=new y({isLazy:aa});if(!x){c('Run').onLeave(y.cleanup);c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,y.cleanup);x=true;}};y.cleanup=function(){'use strict';if(w){w.cleanup();w=null;}};function y(z){var aa=z.isLazy;'use strict';this.$PubcontentFeedChainingControllerX1=c('PubcontentFeedChainingConfig');this.$PubcontentFeedChainingControllerX2=c('FeedAdsChainingConfig');this.$PubcontentFeedChainingControllerX3=c('PubcontentRelatedShareChainingConfig');this.$PubcontentFeedChainingControllerX4=c('PubcontentTopicChainingConfig');this.$PubcontentFeedChainingControllerX5=c('StoryInlinePivotChainingConfig');this.$PubcontentFeedChainingControllerX6=c('RelatedEventsPivotChainingConfig');this.$PubcontentFeedChainingControllerX7=c('SearchRelatedPostsPivotChainingConfig');this.$PubcontentFeedChainingControllerX8={};this.$PubcontentFeedChainingControllerX9=new (c('SubscriptionsHandler'))();this.$PubcontentFeedChainingControllerX9.addSubscriptions(this.$PubcontentFeedChainingControllerX10(c('PageLikeConstants').LIKED,aa,this.$PubcontentFeedChainingControllerX11.bind(this)),this.$PubcontentFeedChainingControllerX10(c('UFIUIEvents').ActionLinkLike,aa,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX10(c('UFIUIEvents').ReactionButtonClicked,aa,this.$PubcontentFeedChainingControllerX12.bind(this)),this.$PubcontentFeedChainingControllerX10(c('UFIUIEvents').Comment,aa,this.$PubcontentFeedChainingControllerX13.bind(this)),this.$PubcontentFeedChainingControllerX10('composer/publish',aa,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX10('LitestandComposer/publish',aa,this.$PubcontentFeedChainingControllerX14.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').ARTICLE_CLICK,aa,this.$PubcontentFeedChainingControllerX15.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').VIDEO_CLICK,aa,this.$PubcontentFeedChainingControllerX16.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').FBVIDEO_CLICK,aa,this.$PubcontentFeedChainingControllerX17.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').GAME_CLICK,aa,this.$PubcontentFeedChainingControllerX18.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').PHOTO_CLICK,aa,this.$PubcontentFeedChainingControllerX19.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').EVENT_JOIN,aa,this.$PubcontentFeedChainingControllerX20.bind(this)),this.$PubcontentFeedChainingControllerX10(c('AttachmentRelatedShareConstants').PRODUCT_CLICK,aa,this.$PubcontentFeedChainingControllerX21.bind(this)));}y.prototype.$PubcontentFeedChainingControllerX10=function(event,z,aa){'use strict';var ba=z?[event,event+'.lazy']:[event];return c('Arbiter').subscribe(ba,aa);};y.prototype.cleanup=function(){'use strict';this.$PubcontentFeedChainingControllerX9&&this.$PubcontentFeedChainingControllerX9.release();this.$PubcontentFeedChainingControllerX9=null;};y.getAdClientTokenIndex=function(){'use strict';return j;};y.prototype.$PubcontentFeedChainingControllerX11=function(z,aa){'use strict';var ba=this.findAdClientToken(aa.target);if(ba){this.$PubcontentFeedChainingControllerX22(aa.target,{origin:k,actor_id:aa.profile_id,client_token:ba});}else this.$PubcontentFeedChainingControllerX23(aa.target,{origin:aa.origin,actor_id:aa.profile_id});};y.prototype.$PubcontentFeedChainingControllerX12=function(z,aa){'use strict';if(!aa.ft_id||!aa.target||!aa.reaction_type)return;if(!this.$PubcontentFeedChainingControllerX24(this.findStory(aa.target))||this.$PubcontentFeedChainingControllerX25(this.findStory(aa.target)))return;c('UFIFeedbackTargets').getFeedbackTarget(aa.ft_id,function(ba,ca){var da=this.findAdClientToken(ba);if(da&&ca.isshare){this.$PubcontentFeedChainingControllerX22(ba,{actor_id:ca.actorid,origin:l,ft_id:ca.entidentifier,client_token:da});}else if(ca.isownerpage){var ea=ca.isshare?q:m,fa=ca.isshare?ca.entidentifier:null;this.$PubcontentFeedChainingControllerX23(ba,{actor_id:ca.actorid,content_id:ca.entidentifier,ft_id:fa,origin:ea});}else if(ca.isshare){this.$PubcontentFeedChainingControllerX23(ba,{actor_id:ca.actorid,content_id:ca.entidentifier,ft_id:ca.entidentifier,origin:q});}else{var ga=c('StoryTopicMap').getTopicsForFTID(ca.entidentifier);if(ga&&ga.length>0){this.$PubcontentFeedChainingControllerX26(ba,{ft_id:ca.entidentifier,origin:r,pivotal_topic_ids:ga});}else this.$PubcontentFeedChainingControllerX27(ba,{origin:t,ft_id:ca.entidentifier});}}.bind(this,aa.target));};y.prototype.$PubcontentFeedChainingControllerX13=function(z,aa){'use strict';if(!aa.ft_id||!aa.target)return;if(!this.$PubcontentFeedChainingControllerX24(this.findStory(aa.target))||this.$PubcontentFeedChainingControllerX25(this.findStory(aa.target)))return;c('UFIFeedbackTargets').getFeedbackTarget(aa.ft_id,function(ba,ca){this.$PubcontentFeedChainingControllerX28(aa.target,{origin:n,action_trigger:'COMMENT',ft_id:ca.entidentifier});}.bind(this,aa.target));};y.prototype.$PubcontentFeedChainingControllerX27=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XPubcontentInlineStoryPivotChainingController').getURIBuilder().setString('origin',aa.origin);if(aa.story_id)ca.setString('storyid',String(aa.story_id));if(aa.ft_id)ca.setString('ftid',String(aa.ft_id));new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca.getURI()).setAllowCrossPageTransition(true).send();return true;};y.prototype.$PubcontentFeedChainingControllerX19=function(z,aa){'use strict';var ba=this;ba.$PubcontentFeedChainingControllerX27(aa.attachment,{origin:s,story_id:aa.storyid});};y.prototype.$PubcontentFeedChainingControllerX15=function(z,aa){'use strict';if(c('AggregatedLinkComposerConfig').no_chained_related_stories==='true')return;aa.origin=n;var ba=this,ca=this.findStory(aa.attachment),da=c('DOMQuery').scry(c('DOMQuery').getRootElement(),'#initial_browse_result').length>0;if(da)return;var ea;if(aa.is_right_click){ea=0;}else ea=c('AttachmentRelatedShareConstants').EVENT_DELAY;setTimeout(function(){if(ca){var fa=ba.findAttachment(ca);if(fa)aa.attachment=fa;}ba.$PubcontentFeedChainingControllerX31(aa.attachment,aa);},ea);};y.prototype.$PubcontentFeedChainingControllerX16=function(z,aa){'use strict';aa.origin=p;var ba=this,ca=this.findStory(aa.attachment);setTimeout(function(){if(ca){var da=ba.findAttachment(ca);if(da)aa.attachment=da;}ba.$PubcontentFeedChainingControllerX31(aa.attachment,aa);},c('AttachmentRelatedShareConstants').EVENT_DELAY);};y.prototype.$PubcontentFeedChainingControllerX17=function(z,aa){'use strict';aa.origin=p;var ba=this,ca=this.findStory(aa.attachment);setTimeout(function(){if(ca){var da=ba.findAttachment(ca);if(da)aa.attachment=da;}ba.$PubcontentFeedChainingControllerX31(aa.attachment,aa);},c('AttachmentRelatedShareConstants').EVENT_DELAY);};y.prototype.$PubcontentFeedChainingControllerX18=function(z,aa){'use strict';var ba=this,ca=this.findStory(aa.attachment);setTimeout(function(){if(ca)var da=ba.findContainer(ca);ba.$PubcontentFeedChainingControllerX32(ca,aa.global_share_id,c('getOrCreateDOMID')(da));},c('AttachmentRelatedShareConstants').EVENT_DELAY);};y.prototype.$PubcontentFeedChainingControllerX20=function(z,aa){'use strict';var ba=this.findStory(aa.attachment);if(ba){var ca=this.findAttachment(ba);if(ca)aa.attachment=ca;}this.$PubcontentFeedChainingControllerX33(aa.attachment,{origin:u,event_id:aa.event_id});};y.prototype.$PubcontentFeedChainingControllerX21=function(z,aa){'use strict';aa.origin=o;var ba=this.findStory(aa.attachment);if(ba){var ca=this.findAttachment(ba);if(ca)aa.attachment=ca;}this.$PubcontentFeedChainingControllerX34(aa.attachment,aa);};y.prototype.$PubcontentFeedChainingControllerX14=function(z,aa){'use strict';var ba=this;setTimeout(function(){ba.$PubcontentFeedChainingControllerX35(aa.markup.firstChild,{origin:v,content_id:aa.content_id});},this.$PubcontentFeedChainingControllerX7.composer_publish_action);};y.prototype.$PubcontentFeedChainingControllerX36=function(z){'use strict';return !!(z&&z.id&&!c('CSS').matchesSelector(z,"._sf6")&&!(z.id in this.$PubcontentFeedChainingControllerX8));};y.prototype.$PubcontentFeedChainingControllerX37=function(z){'use strict';if(!z)return false;if(z.origin in this.$PubcontentFeedChainingControllerX1||z.origin in this.$PubcontentFeedChainingControllerX3||z.origin in this.$PubcontentFeedChainingControllerX2||z.origin in this.$PubcontentFeedChainingControllerX5||z.origin in this.$PubcontentFeedChainingControllerX6||z.origin in this.$PubcontentFeedChainingControllerX7||z.origin===o){return true;}else{var aa=this.$PubcontentFeedChainingControllerX4[z.origin];if(!aa||!aa.rate)return false;var ba=Math.random();if(ba>aa.rate)return false;return true;}};y.prototype.$PubcontentFeedChainingControllerX38=function(z){'use strict';this.$PubcontentFeedChainingControllerX8[z]=true;};y.prototype.$PubcontentFeedChainingControllerX30=function(z){'use strict';delete this.$PubcontentFeedChainingControllerX8[z];};y.prototype.$PubcontentFeedChainingControllerX24=function(z){'use strict';if(!z)return false;var aa="_3lkn",ba=z.nextSibling,ca=true;if(ba&&ba.firstChild){var da=ba.firstChild;ca=!(da.hasChildNodes()&&c('CSS').hasClass(da,aa));}if(!ca)return false;var ea=z.children[0],fa=z.children[1],ga="_4_ck";if(ea&&c('CSS').hasClass(ea,ga)||fa&&c('CSS').hasClass(fa,ga))return false;return true;};y.prototype.$PubcontentFeedChainingControllerX25=function(z){'use strict';if(!z)return true;var aa=c('DOM').scry(z,"._1xwr");if(aa.length)return true;return false;};y.prototype.$PubcontentFeedChainingControllerX29=function(z,aa){'use strict';var ba=this.findStory(z);if(!this.$PubcontentFeedChainingControllerX36(ba))return null;if(!this.$PubcontentFeedChainingControllerX37(aa))return null;this.$PubcontentFeedChainingControllerX38(ba.id);if(this.isSponsoredStory(ba))return null;var ca;if(!aa.continued_chaining){ca=this.findContainer(ba);if(!ca)return null;var da=c('DOM').create('div'),ea=c('DOM').appendContent(ca,da);if(ea.length!==1)return null;}else{ca=ba;da=c('DOM').create('div');ea=c('DOM').insertAfter(ca,da);c('DOM').remove(ca);if(ea.length!==1)return null;}if(aa.is_auto_expand){return {chainingWrapper:ea[0],story:ba,is_auto_expand:aa.is_auto_expand};}else return {chainingWrapper:ea[0],story:ba};};y.prototype.$PubcontentFeedChainingControllerX22=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=this.findStreamRoot(ba.story);if(!ca)return false;var da=ca.getAttribute('id'),ea=c('XFeedAdsChainingController').getURIBuilder().setString('actor_id',aa.actor_id).setString('origin',aa.origin).setString('ei',aa.client_token).setString('data_ownerid',da);if(aa.ft_id)ea.setString('ft_id',aa.ft_id);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ea.getURI()).send();return true;};y.prototype.$PubcontentFeedChainingControllerX31=function(z,aa){'use strict';if(!this.$PubcontentFeedChainingControllerX24(this.findStory(z)))return false;var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;c('CSS').addClass(ba.chainingWrapper,"_3lkn");var ca=null;if(aa.fbvideo_id){ca=c('XPubcontentRelatedVideoChainingController').getURIBuilder();ca.setInt('fbvideo_id',aa.fbvideo_id);}else{ca=c('XPubcontentRelatedShareChainingController').getURIBuilder();ca.setInt('global_share_id',aa.global_share_id);}ca.setString('attachment_div_id',c('getOrCreateDOMID')(aa.attachment));if(aa.link_url)ca.setString('link_url',aa.link_url);if(aa.video_div_id)ca.setString('video_div_id',aa.video_div_id);if(aa.share_id)ca.setString('share_id',aa.share_id);var da=JSON.parse(ba.story.getAttribute('data-ft'))||{};if('qid' in da&&'mf_story_key' in da){ca.setString('qid',da.qid);ca.setString('mf_story_key',da.mf_story_key);}if(aa.is_auto_expand){this.$PubcontentFeedChainingControllerX30(ba.story.id);ca.setBool('is_auto_expand',aa.is_auto_expand);}var ea=new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca.getURI());da&&ea.setData(da);ea.send();return true;};y.prototype.$PubcontentFeedChainingControllerX32=function(z,aa,ba){'use strict';if(!this.$PubcontentFeedChainingControllerX36(z))return null;this.$PubcontentFeedChainingControllerX38(z.id);var ca=c('XRelatedGamesChainingController').getURIBuilder().setInt('app_id',aa).setString('attachment_div_id',ba);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,z.id)).setURI(ca.getURI()).send();return true;};y.prototype.$PubcontentFeedChainingControllerX23=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XPubcontentFeedChainingController').getURIBuilder().setString('actor_id',aa.actor_id).setString('origin',aa.origin);if(aa.ft_id)ca.setString('ft_id',aa.ft_id);if(aa.content_id)ca.setString('content_id',aa.content_id);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca.getURI()).send();return true;};y.prototype.$PubcontentFeedChainingControllerX26=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XPubcontentTopicChainingController').getURIBuilder().setIntVector('pivotal_topic_ids',aa.pivotal_topic_ids).getURI();new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca).send();return true;};y.prototype.$PubcontentFeedChainingControllerX33=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XEventRelatedEventsPivotController').getURIBuilder().setInt('event_id',aa.event_id).setString('attachment_id',c('getOrCreateDOMID')(z)).getURI();new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca).send();return true;};y.prototype.$PubcontentFeedChainingControllerX34=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XPubcontentCommerceProductChainingController').getURIBuilder().setString('attachment_id',c('getOrCreateDOMID')(z)).setInt('product_id',aa.product_id).getURI();new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca).send();return true;};y.prototype.$PubcontentFeedChainingControllerX35=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XSearchRelatedPostsPivotController').getURIBuilder().setString('origin',aa.origin).setString('content_id',String(aa.content_id));new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca.getURI()).setAllowCrossPageTransition(true).send();return true;};y.prototype.$PubcontentFeedChainingControllerX28=function(z,aa){'use strict';var ba=this.$PubcontentFeedChainingControllerX29(z,aa);if(!ba)return false;var ca=c('XQuickPromotionFeedPivotController').getURIBuilder().setString('action_trigger',String(aa.action_trigger));if(aa.ft_id)ca.setString('ft_id',aa.ft_id);new (c('AsyncRequest'))().setErrorHandler(this.$PubcontentFeedChainingControllerX30.bind(this,ba.story.id)).setRelativeTo(ba.chainingWrapper).setURI(ca.getURI()).setAllowCrossPageTransition(true).send();return true;};y.prototype.findStory=function(z){'use strict';var aa="^div._4-u2",ba=c('DOM').scry(z,aa);return ba.length===1?ba[0]:null;};y.prototype.isSponsoredStory=function(z){'use strict';var aa="._5paw";return c('DOM').scry(z,aa).length>0;};y.prototype.findAttachment=function(z){'use strict';var aa="div._6m2",ba="div.iframeEmbed",ca=c('DOM').scry(z,aa)[0]||c('DOM').scry(z,ba)[0];return ca;};y.prototype.findContainer=function(z){'use strict';var aa=c('DOM').create('div'),ba=c('DOM').insertAfter(z,aa);c('ContextualThing').register(aa,z);return ba.length>=1?ba[0]:null;};y.prototype.findStreamRoot=function(z){'use strict';var aa="^div._4ikz";return c('DOM').scry(z,aa)[0];};y.prototype.findAdClientToken=function(z){'use strict';var aa=this.findStory(z);if(!aa)return null;var ba=aa.getAttribute('data-ft');if(!ba)return null;var ca=JSON.parse(ba);return ca[y.getAdClientTokenIndex()];};f.exports=y;},null);