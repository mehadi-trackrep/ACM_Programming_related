/*!CK:3613146297!*//*1460082875,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["okRA\/"]); }

__d('InterestListMenu',['cx','Arbiter','AsyncRequest','CSS','DataStore','DOM','EditSubscriptions','Event','MenuDeprecated','PageGetNotificationConstants','Parent','SocialGoodCharityActionsLoggerUtils','XPageGetNewsFeedSaveController','XPageGetNotificationSaveController','XPageUserFanningSettingsStatusController','isElementNode'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(o,p,q,r,s){var t=c('MenuDeprecated').isItemChecked(q);c('MenuDeprecated').setItemChecked(q,!t);new (c('AsyncRequest'))().setURI('/ajax/lists/modify.php').setMethod('POST').setData({list_id:p,profile_id:o,add_to_list:!t,location:r}).setHandler(s).setErrorHandler(function(){c('MenuDeprecated').setItemChecked(q,t);}).send();}function j(o,p,q){for(var r=0;r<o.length;r++)if(p==k(o[r]))c('MenuDeprecated').setItemChecked(o[r],q);}function k(o){if(!c('isElementNode')(o))return null;var p=c('DOM').scry(o,'a.itemAnchor');if(!p)return null;return c('DataStore').get(p[0],'list-id');}function l(o){if(!c('isElementNode')(o))return null;var p=c('DOM').scry(o,'a.itemAnchor');if(!p)return null;return c('DataStore').get(p[0],'action');}function m(o){if(!c('isElementNode')(o))return null;var p=c('DOM').scry(o,'a.itemAnchor');if(!p)return null;return c('DataStore').get(p[0],'type');}var n={init:function(o,p,q,r){c('Event').listen(o,'click',function(event){var s=c('Parent').byClass(event.getTarget(),'uiMenuItem');if(s&&c('CSS').hasClass(s,'InterestListMenuItem')){var t=c('MenuDeprecated').isItemChecked(s),u=k(s);i(p,u,s,q,function(){c('Parent').byTag(event.getTarget(),'a').blur();});j(c('DOM').scry(o,'.InterestListMenuItem'),u,!t);}});c('EditSubscriptions').init(o,p,r);},initPageNewFlyout:function(o,p){c('Event').listen(o,'click',function(event){var q=c('Parent').byClass(event.getTarget(),'uiMenuItem');if(!q)return;var r=c('MenuDeprecated').isItemChecked(q),s=null;if(c('CSS').hasClass(q,'PageGetNotificationMenuItem')){c('MenuDeprecated').setItemChecked(q,!r);s=c('XPageGetNotificationSaveController').getURIBuilder().setInt('page_id',p).setEnum('type',m(q)).setBool('status',!r).setEnum('ref','flyout').getURI();new (c('AsyncRequest'))().setURI(s).setHandler(function(){c('Parent').byTag(event.getTarget(),'a').blur();c('Arbiter').inform(c('PageGetNotificationConstants').Events.CHANGE,{pageid:String(p)});}).send();}else if(c('CSS').hasClass(q,'PageGetNewsFeedMenuItem')){if(!r){Array.from(q.parentNode.childNodes).forEach(function(t){if(c('CSS').hasClass(t,'uiMenuItem'))c('MenuDeprecated').setItemChecked(t,false);});c('MenuDeprecated').setItemChecked(q,true);}s=c('XPageGetNewsFeedSaveController').getURIBuilder().setInt('page_id',p).setEnum('follow',m(q)).setEnum('ref','flyout').getURI();new (c('AsyncRequest'))().setURI(s).setHandler(function(){c('Parent').byTag(event.getTarget(),'a').blur();c('Arbiter').inform(c('PageGetNotificationConstants').Events.CHANGE,{pageid:String(p)});}).send();}});c('Arbiter').subscribe(c('PageGetNotificationConstants').Events.CHANGE,function(q,r){if(p===r.pageid){if('follow_status' in r){this._onNotificationChange(r,o);this._onNewsFeedChange(r.follow_status,o);return;}var s=c('XPageUserFanningSettingsStatusController').getURIBuilder().setString('page_id',r.pageid).getURI();new (c('AsyncRequest'))(s).setHandler(function(t){this._onNotificationChange(t.payload,o);this._onNewsFeedChange(t.payload.follow_status,o);}.bind(this)).send();}}.bind(this));c('Arbiter').subscribe(c('PageGetNotificationConstants').Events.NEWSFEED_CHANGE,function(q,r){if(p===r.pageid&&'follow_status' in r)this._onNewsFeedChange(r.follow_status,o);}.bind(this));c('Arbiter').subscribe(c('PageGetNotificationConstants').Events.NOTIFICATION_CHANGE,function(q,r){if(p===r.pageid)this._onNotificationChange(r,o);}.bind(this));},_onNewsFeedChange:function(o,p){var q=p.getElementsByClassName('PageGetNewsFeedMenuItem');Array.from(q).forEach(function(r){if(c('CSS').hasClass(r,'uiMenuItem')){var s=c('DataStore').get(r.firstChild,'type')===o;c('MenuDeprecated').setItemChecked(r,s);}});},_onNotificationChange:function(o,p){var q=p.getElementsByClassName('PageGetNotificationMenuItem');Array.from(q).forEach(function(r){if(c('CSS').hasClass(r,'uiMenuItem'))c('MenuDeprecated').setItemChecked(r,o[m(r)]);});},initMenu:function(o){c('MenuDeprecated').register(o,false);},goBack:function(o,p){c('Event').listen(o,'click',function(event){c('CSS').removeClass(p,'pageGetNotificationOpen');c('CSS').removeClass(p,'pageGetNewsFeedOpen');c('CSS').addClass(p,'initialFlyout');});},getNotificationOption:function(o,p){c('Event').listen(o,'click',function(event){c('CSS').removeClass(p,'initialFlyout');c('CSS').addClass(p,'pageGetNotificationOpen');});},getNewsFeedOption:function(o,p){c('Event').listen(o,'click',function(event){c('CSS').removeClass(p,'initialFlyout');c('CSS').addClass(p,'pageGetNewsFeedOpen');});},initFollowSwitcher:function(o,p,q,r){var s=[p,q];c('Event').listen(o,'click',function(event){var t=c('Parent').byClass(event.getTarget(),'uiMenuItem'),u=l(t);if(u==='regular_follow'||u==='see_first'){s.forEach(function(v){c('CSS').removeClass(v,"_52-0");});c('CSS').addClass(t,"_52-0");}else if(u==='unfollow'){if(r&&r.is_fundraiser)c('SocialGoodCharityActionsLoggerUtils').logFollowActionClick(false,r.logging_info);c('CSS').addClass(o,"_3siw");s.forEach(function(v){c('CSS').removeClass(v,"_52-0");});}else if(u==='follow'){if(r&&r.is_fundraiser)c('SocialGoodCharityActionsLoggerUtils').logFollowActionClick(true,r.logging_info);c('CSS').removeClass(o,"_3siw");c('CSS').addClass(q,"_52-0");}});}};f.exports=b.InterestListMenu||n;},null);
__d('legacy:InterestListMenu',['InterestListMenu'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.InterestListMenu=c('InterestListMenu');},3);